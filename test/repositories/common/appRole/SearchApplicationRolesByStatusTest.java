package repositories.common.appRole;

import models.common.AppRole;
import models.common.AppStatus;
import org.junit.Test;
import play.test.WithApplication;
import repositories.common.appStatus.I_AppStatusByNameSearchable;
import repositories.common.appStatus.SearchAllAppStatusesTest;
import repositories.common.appStatus.SearchAppStatusByName;

import java.util.Date;
import java.util.HashMap;

import static junit.framework.TestCase.assertEquals;
import static junit.framework.TestCase.assertNotNull;
import static junit.framework.TestCase.assertNull;
import static play.test.Helpers.fakeApplication;
import static play.test.Helpers.inMemoryDatabase;
import static play.test.Helpers.running;

/**
 * Created by adrian on 17.07.16.
 */
public class SearchApplicationRolesByStatusTest extends WithApplication implements I_AppStatusByNameSearchable,
        I_AppRolesByStatusSearchable {

    public String sampleAppRoleName = "sampleRole";
    public String sampleAppRoleDescription = "sample role description";
    public String sampleAppStatusName = "sample";
    public String fakeAppStatusName = "fake";

    /**
    @Test
    public void searchAppRolesByNullAppStatusTest(){

        running(fakeApplication(inMemoryDatabase("test")), () -> {

            SearchAllAppStatusesTest searchAllAppStatusesTest = new SearchAllAppStatusesTest();
            searchAllAppStatusesTest.createSampleStatus();
            AppStatus appStatus = null;
            HashMap<String, AppRole> appRolesHashMap = searchAppRolesByStatus(appStatus);

            assertNull(appRolesHashMap);

        });

    }
    **/

    /**
    @Test
    public void searchAppRolesByFakeStatusTest(){

        running(fakeApplication(inMemoryDatabase("test")), () -> {

            SearchAllAppStatusesTest searchAllAppStatusesTest = new SearchAllAppStatusesTest();
            searchAllAppStatusesTest.createSampleStatus();
            createAppRole();
            AppStatus appStatus = searchAppStatusByName(fakeAppStatusName);
            HashMap<String, AppRole> appRolesHashMap = searchAppRolesByStatus(appStatus);

            assertNull(appRolesHashMap);

        });

    } */

    @Test
    public void searchAppRolesByStatusNullTest(){

        running(fakeApplication(inMemoryDatabase("test")), () -> {

            SearchAllAppStatusesTest searchAllAppStatusesTest = new SearchAllAppStatusesTest();
            searchAllAppStatusesTest.createSampleStatus();
            AppStatus appStatus = searchAppStatusByName(sampleAppStatusName);
            HashMap<String, AppRole> appRolesHashMap = searchAppRolesByStatus(appStatus);

            assertNull(appRolesHashMap);

        });

    }

    @Test
    public void searchAppRolesByStatusTest(){

        running(fakeApplication(inMemoryDatabase("test")), () -> {

            SearchAllAppStatusesTest searchAllAppStatusesTest = new SearchAllAppStatusesTest();
            searchAllAppStatusesTest.createSampleStatus();
            createAppRole();
            AppStatus appStatus = searchAppStatusByName(sampleAppStatusName);
            HashMap<String, AppRole> appRolesHashMap = searchAppRolesByStatus(appStatus);

            assertNotNull(appRolesHashMap);
            assertNotNull(appRolesHashMap.get(sampleAppRoleName));
            assertEquals(appRolesHashMap.get(sampleAppRoleName).appRoleName, sampleAppRoleName);
            assertEquals(appRolesHashMap.get(sampleAppRoleName).appRoleDescription, sampleAppRoleDescription);

        });

    }

    @Override
    public AppStatus searchAppStatusByName(String appStatusName) {

        SearchAppStatusByName searchAppStatusByName = new SearchAppStatusByName();
        return searchAppStatusByName.searchAppStatusByName(appStatusName);

    }

    public void createAppRole(){

        AppRole appRole = new AppRole();
        appRole.appRoleName = sampleAppRoleName;
        appRole.appRoleDescription = sampleAppRoleDescription;
        appRole.appStatus = searchAppStatusByName(sampleAppStatusName);
        appRole.appRoleCreationDate = new Date();
        appRole.appRoleUpdateDate = new Date();
        appRole.save();

    }

    @Override
    public HashMap<String, AppRole> searchAppRolesByStatus(AppStatus appStatus) {

        SearchAppRolesByStatus searchAppRolesByStatus = new SearchAppRolesByStatus();
        return searchAppRolesByStatus.searchAppRolesByStatus(appStatus);

    }
}
