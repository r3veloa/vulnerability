package repositories.common.appRole;

import models.common.AppRole;
import models.common.AppStatus;
import org.junit.Test;
import play.test.WithApplication;
import repositories.common.appStatus.I_AppStatusByNameSearchable;
import repositories.common.appStatus.SearchAllAppStatusesTest;
import repositories.common.appStatus.SearchAppStatusByName;

import java.util.Date;
import java.util.HashMap;

import static junit.framework.TestCase.assertEquals;
import static junit.framework.TestCase.assertNotNull;
import static junit.framework.TestCase.assertNull;
import static play.test.Helpers.fakeApplication;
import static play.test.Helpers.inMemoryDatabase;
import static play.test.Helpers.running;

/**
 * Created by adrian on 17.07.16.
 */
public class SearchAllApplicationRolesTest extends WithApplication implements I_AllAppRolesSearchable, I_AppStatusByNameSearchable {

    public String sampleAppRoleName = "sampleRole";
    public String sampleAppRoleDescription = "sample role description";
    public String sampleAppStatusName = "sample";

    @Test
    public void searchAllAppRolesNullTest(){

        running(fakeApplication(inMemoryDatabase("test")), () -> {

            SearchAllAppStatusesTest searchAllAppStatusesTest = new SearchAllAppStatusesTest();
            searchAllAppStatusesTest.createSampleStatus();
            HashMap<String, AppRole> appRolesHashMap = searchAllAppRoles();

            assertNull(appRolesHashMap);

        });

    }

    @Test
    public void searchAllAppRolesTest(){

        running(fakeApplication(inMemoryDatabase("test")), () -> {

            SearchAllAppStatusesTest searchAllAppStatusesTest = new SearchAllAppStatusesTest();
            searchAllAppStatusesTest.createSampleStatus();
            createAppRole();
            HashMap<String, AppRole> appRolesHashMap = searchAllAppRoles();

            assertNotNull(appRolesHashMap);
            assertNotNull(appRolesHashMap.get(sampleAppRoleName));
            assertEquals(appRolesHashMap.get(sampleAppRoleName).appRoleName, sampleAppRoleName);
            assertEquals(appRolesHashMap.get(sampleAppRoleName).appRoleDescription, sampleAppRoleDescription);

        });

    }

    @Override
    public HashMap<String, AppRole> searchAllAppRoles() {

        SearchAllApplicationRoles searchAllApplicationRoles = new SearchAllApplicationRoles();
        return searchAllApplicationRoles.searchAllAppRoles();

    }

    @Override
    public AppStatus searchAppStatusByName(String appStatusName) {

        SearchAppStatusByName searchAppStatusByName = new SearchAppStatusByName();
        return searchAppStatusByName.searchAppStatusByName(appStatusName);

    }

    public void createAppRole(){


        AppRole appRole = new AppRole();
        appRole.appRoleName = sampleAppRoleName;
        appRole.appRoleDescription = sampleAppRoleDescription;
        appRole.appStatus = searchAppStatusByName(sampleAppStatusName);
        appRole.appRoleCreationDate = new Date();
        appRole.appRoleUpdateDate = new Date();
        appRole.save();

    }
}
